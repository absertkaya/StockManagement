@page "/scanner"
@inject IJSRuntime JSRuntime
@inject NavigationManager NavigationManager

<h1 class="title">Scan barcode from Video Camera</h1>

<div>
    <button @ref="startButton" id="startButton">Start</button>
    <button @ref="resetButton" id="resetButton">Reset</button>
</div>

<div>
    <video @ref="video" id="video" width="600" height="400" style="border: 1px solid gray"></video>
</div>

<div @ref="sourceSelectPanel" id="sourceSelectPanel">
    <label for="sourceSelect">Verander videobron:</label>
    <select @ref="sourceSelect" id="sourceSelect" style="max-width:400px">
    </select>
</div>

<p>Geef barcode handmatig in:</p>
<EditForm OnValidSubmit="HandleValidSubmit">
    <p>
        Barcode:
        <InputText @bind-Value="_serialnr" @ref="result" type="text" id="result" />
    </p>
    <button type="submit">Geef in</button>
</EditForm>

<button>Sla over</button>


@code {

    private string _serialnr;

    private ElementReference startButton;
    private ElementReference resetButton;
    private ElementReference video;
    private ElementReference sourceSelectPanel;
    private ElementReference sourceSelect;
    private ElementReference result;

    protected override async Task OnAfterRenderAsync(bool firstrender)
    {
        if (firstrender)
            await JSRuntime.InvokeVoidAsync("JsFunctions.scanner");
    }

    private void HandleValidSubmit()
    {
        NavigationManager.NavigateTo("itemform/" + _serialnr);
    }
}
